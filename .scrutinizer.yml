build:
  environment:
    node: "v12.9.1"
  project_setup:
    override:
      - yes | pecl install redis
      - php artisan passport:keys
  cache:
    directories:
      - vendor/
      - ~/.composer/cache/
  nodes:
    tests:
      environment:
        php:
          version: 7.4
          compile_options: '--enable-cli --with-openssl --with-imap-ssl --enable-bcmath --enable-mbstring --with-zlib --enable-pcntl --enable-gd --with-xsl --with-sodium --with-zlib --without-pear'
          pecl_extensions:
            - zip
            - redis
            - pcov
    analysis:
      environment:
        php:
          version: 7.4
          pecl_extensions:
            - zip
            - redis
            - pcov

  tests:
    before:
      - chmod -R 777 storage
      - chmod -R 777 bootstrap/cache
    override:
      - command: php -dpcov.enabled=1 -dpcov.directory=. -dpcov.exclude="~vendor~" ./vendor/bin/phpunit --coverage-clover coverage.xml
        coverage:
          file: coverage.xml
          format: clover
